<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8">
		<meta name="viewport" content="initial-scale=1, maximum-scale=1, user-scalable=no, minimal-ui">
		<meta name="apple-mobile-web-app-capable" content="yes">
		<meta name="apple-mobile-web-app-status-bar-style" content="black">
		<title>精品推荐</title>
		<link rel="stylesheet" href="../../components/fox-core/dist/foxui.css">
		<link rel="stylesheet" href="css/style.css"/>
<script src="js/base.js"></script>
		<script src="js/bl_base.js"></script>
		<script src="js/line.js"></script>
		<script src="js/fastclick.js"></script>
		<script src="../../components/fox-core/dist/foxui.js"></script>
		<link rel="import" href="../../components/fox-content/dist/fox-content.html"/>
		<link rel="import" href="../../components/fox-icon/dist/fox-icon.html"/>
		<link rel="import" href="../../components/fox-tabbar/dist/fox-tabbar.html"/>
		<link rel="import" href="../../components/fox-page/dist/fox-page.html"/>
		<link rel="import" href="../../components/fox-model/dist/fox-model.html"/>
		<link rel="import" href="../../components/fox-toolbar/dist/fox-toolbar.html"/>
		<link rel="import" href="../../components/fox-slider/src/fox-slider.html"/>
		<link rel="import" href="../../components/fox-ajax/dist/fox-ajax.html"/>
		<link rel="import" href="../../components/fox-page-content/dist/fox-page-content.html"/>
		<link rel="import" href="../../components/fox-template/src/fox-template.html"/>
		<script src="js/map_api.js"></script>
		<script src="js/app.js"></script>
	</head>
	<body style="visibility: hidden;">
		<fox-page transition="hslide">
			<fox-toolbar class="primary" title="列表">
				<fox-icon icon="icon-left-nav" class="left" onclick="history.back();"></fox-icon>
				<label onclick="history.back();" class="right">地图</label>
			</fox-toolbar>
			<fox-page-content id="list-content" style="background: rgb(241,240,246);">
				<div class="list-page" style="display:none;" id="list-prev">上一页</div>
				<fox-template id="list-tmpl" style="visibility: visible;">
					
					<div class="list-item" rv-each-item="data">
						<div class="row1">
							<span class="title">{index|indexPlus}.{item.name}</span>
							<span class="distance" >{item.distance}m</span>
						</div>
						<div class="row2">
							<label>居住热度:</label>
							<div class="hot-spot">
								<div class="hot-inner" rv-style-width-percent="item.hotspot"></div>
							</div>
						</div>
						<div class="row3">
							<label>
								通勤时间:
							</label>
							<span>{item.time}min({item.transfer1 | transferFormatter})</span>
							
						</div>
						<div class="row4">
							<label>
								两居均价:
							</label>
							<span>{item.price}￥</span>
							
						</div>
						<div class="row5">
							<label>
								距离地铁:
							</label>
							<span>{item.metro_name}{item.metro_stop_name}({item.loc}m)</span>
						</div>
						<a transition="hslide" class="match_parent" rv-href="item.detailLink"></a>

					</div>
					
				</fox-template>
				<div class="list-page" style="display:none;" id="list-next">下一页</div>
			</fox-page-content>
		</fox-page>
		<script>
			(function() {
				var $prev = $("#list-prev"),
					$next = $("#list-next"),
					$content = $("#list-content");
				var tmpl = $("#list-tmpl").get(0);
				var params = Utils.getURLParams();
				var ListRequest = (function(){
					
					var page = 1;
					
					
					
					function doRequest(){
						if(page < 0){
							page = 0;
						}
						if(page == 0){
							$prev.hide();
						}else{
							$prev.show();
						}
						Utils.getMapData(params['lng'], params['lat'], page, function(mapdata) {
							var res = mapdata.getDetailList();
							
							tmpl.data = res.list;
							
							doPager(res.count,res);
							$content.scrollTop(0);
							window.mapPage&&mapPage.drawPage(mapdata,page);
						});
						
					}
					
					function doPager(count){
						var totalpage = (count+(10-1))/10;
						
						if(page < totalpage-1){
							$next.show();
						}else{
							$next.hide();
						}
					}
					
					return {
						prev:function(){
							page--;
							doRequest();
						},
						next:function(){
							page++;
							doRequest();
						},
						init:function(_page){
							page = _page;
							doRequest();
						}
					};
					
				})();
				
				$prev.bind("click",function(){
					ListRequest.prev();
				});
				
				$next.bind("click",function(){
					ListRequest.next();
				});

				ListRequest.init(parseInt(params['page']));

			})();
		</script>
	</body>
</html>
